(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[921],{6981:function(e,t,s){Promise.resolve().then(s.bind(s,3971))},3971:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return l}});var r=s(7437),o=s(2265),a=s(6463),n=s(6264);function l(){let e=(0,a.useRouter)(),t=(0,a.useParams)(),s=null==t?void 0:t.token,[l,i]=(0,o.useState)(""),[d,u]=(0,o.useState)(""),[c,m]=(0,o.useState)(""),[h,v]=(0,o.useState)(""),[f,p]=(0,o.useState)(!1),g=async t=>{if(t.preventDefault(),v(""),m(""),!l||!d){v("Please enter and confirm your new password.");return}if(l!==d){v("Passwords do not match.");return}try{p(!0);let t=await n.iJ.resetPassword({newPassword:l},s);m(t.message||"Password reset successful. Redirecting..."),setTimeout(()=>e.push("/login"),2e3)}catch(e){v((null==e?void 0:e.message)||"Reset failed. Please try again.")}finally{p(!1)}};return(0,r.jsx)("div",{className:"min-h-screen flex items-center justify-center p-6",children:(0,r.jsxs)("div",{className:"card max-w-md w-full p-8 bg-white/10 backdrop-blur-lg rounded-2xl",children:[(0,r.jsx)("h1",{className:"h1 mb-6 text-center text-white",children:"Reset Password"}),h&&(0,r.jsx)("div",{className:"mb-4 text-red-300",children:h}),c&&(0,r.jsx)("div",{className:"mb-4 text-green-300",children:c}),(0,r.jsxs)("form",{onSubmit:g,className:"space-y-4",children:[(0,r.jsx)("input",{className:"input bg-white text-black placeholder-gray-500 w-full",placeholder:"New password",type:"password",value:l,onChange:e=>i(e.target.value),required:!0}),(0,r.jsx)("input",{className:"input bg-white text-black placeholder-gray-500 w-full",placeholder:"Confirm new password",type:"password",value:d,onChange:e=>u(e.target.value),required:!0}),(0,r.jsx)("button",{className:"btn btn-primary w-full",disabled:f,children:f?"Resetting...":"Reset Password"})]}),(0,r.jsx)("p",{className:"mt-4 text-sm text-white/70 text-center",children:(0,r.jsx)("a",{href:"/login",className:"text-brand-300 hover:underline",children:"Back to login"})})]})})}},6264:function(e,t,s){"use strict";s.d(t,{BG:function(){return l},Nq:function(){return u},iJ:function(){return d},xU:function(){return i}});let r="http://localhost:8000/api";function o(){return{adminId:localStorage.getItem("adminId")||"",userId:localStorage.getItem("userId")||""}}async function a(e){if(204===e.status)return null;let t=await e.text();if(!t)return null;try{return JSON.parse(t)}catch(e){return t}}async function n(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!r)throw Error("Missing NEXT_PUBLIC_API_URL");let s=t.body instanceof FormData,o=s?{}:{"Content-Type":"application/json"},n=t.token||localStorage.getItem("token")||"";n&&(o.Authorization="Bearer ".concat(n));let l=await fetch("".concat(r).concat(e),{method:t.method||"GET",headers:o,body:t.body?s?t.body:JSON.stringify(t.body):void 0});if(!l.ok){let e="Request failed: ".concat(l.status);try{let t=await l.json();(null==t?void 0:t.message)?e=t.message:"string"==typeof t&&(e=t)}catch(t){try{let t=await l.text();t&&(e=t)}catch(e){}}throw Error(e)}return await a(l)}let l={me:e=>n("/users/profile",{method:"GET",token:e}),getById:(e,t)=>n("/users/".concat(e),{method:"GET",token:t}),search:(e,t)=>n("/users/search?q=".concat(encodeURIComponent(e)),{method:"GET",token:t}),changePassword:e=>n("/users/password/change",{method:"POST",body:e}),requestPasswordOtp:()=>n("/users/password/request-otp",{method:"POST"}),resetPasswordWithOtp:e=>n("/users/password/reset-otp",{method:"POST",body:e}),updateProfile:(e,t)=>n("/users/profile",{method:"PUT",body:e,token:t}),stats:e=>n("/users/me/stats",{method:"GET",token:e}),unread:e=>n("/users/messages/unread",{method:"GET",token:e})},i={getConversation:(e,t)=>n("/chat/".concat(e),{method:"GET",token:t}),sendMessage:(e,t)=>{let{adminId:s,userId:r}=o(),a=(null==t?void 0:t.senderId)||s||r||"";if(console.log("\uD83D\uDCE4 Sending message:",{sender:a,receiver:e.to,message:e.message,fileUrl:e.fileUrl,type:e.type}),!e.to)throw Error("Receiver ID (data.to) is missing!");return n("/chat/send",{method:"POST",body:{sender:a,receiver:e.to,message:e.message||"",fileUrl:e.fileUrl||"",type:e.type||"text"},token:null==t?void 0:t.token})},upload:async(e,t)=>{let s=await n("/chat/upload",{method:"POST",body:e,token:t}),r=(null==s?void 0:s.fileUrl)||(null==s?void 0:s.url)||"";if(!r)throw Error("Upload failed: missing fileUrl");return{fileUrl:r}},removeUser:(e,t)=>n("/chat/remove/".concat(e),{method:"DELETE",token:t}),getConversations:async e=>{let{userId:t}=o();if(!t)return[];let s=await n("/chat/".concat(t),{method:"GET",token:e});if(!Array.isArray(s)||0===s.length)return[];let r=s[s.length-1],a=(null==r?void 0:r.message)||((null==r?void 0:r.type)==="image"?"[Image]":(null==r?void 0:r.type)==="audio"?"[Audio]":(null==r?void 0:r.type)==="emoji"?"[Emoji]":"");return[{_id:(null==r?void 0:r._id)||"conv-".concat(t),userId:t,lastMessage:a||"",updatedAt:(null==r?void 0:r.createdAt)||new Date().toISOString()}]}},d={register:e=>n("/auth/register",{method:"POST",body:e}),verifyOtp:e=>n("/auth/verify-otp",{method:"POST",body:e}),login:async e=>{var t,s,r,o,a,l;let i=await n("/auth/login",{method:"POST",body:e}),d=(null==i?void 0:i.token)||(null==i?void 0:i.accessToken)||"",u={_id:(null==i?void 0:i._id)||(null==i?void 0:null===(t=i.user)||void 0===t?void 0:t._id)||"",name:(null==i?void 0:i.name)||(null==i?void 0:null===(s=i.user)||void 0===s?void 0:s.name)||"",email:(null==i?void 0:i.email)||(null==i?void 0:null===(r=i.user)||void 0===r?void 0:r.email)||"",photo:(null==i?void 0:i.photo)||(null==i?void 0:null===(o=i.user)||void 0===o?void 0:o.photo)||void 0,role:(null==i?void 0:i.role)||(null==i?void 0:null===(a=i.user)||void 0===a?void 0:a.role)||void 0,createdAt:(null==i?void 0:i.createdAt)||(null==i?void 0:null===(l=i.user)||void 0===l?void 0:l.createdAt)||void 0};if(!d||!u._id)throw Error("Invalid login response from server");return{token:d,user:u}},forgotPassword:e=>n("/auth/forgot-password",{method:"POST",body:e}),resetPassword:(e,t)=>n("/auth/reset-password",{method:"POST",body:e,token:t}),resendOtp:e=>n("/auth/resend-otp",{method:"POST",body:e})},u={stats:e=>n("/admin/stats",{method:"GET",token:e}),usersList:e=>n("/admin/users/list",{method:"GET",token:e}),usersAll:e=>n("/admin/users/all",{method:"GET",token:e})}},6463:function(e,t,s){"use strict";var r=s(1169);s.o(r,"useParams")&&s.d(t,{useParams:function(){return r.useParams}}),s.o(r,"usePathname")&&s.d(t,{usePathname:function(){return r.usePathname}}),s.o(r,"useRouter")&&s.d(t,{useRouter:function(){return r.useRouter}}),s.o(r,"useSearchParams")&&s.d(t,{useSearchParams:function(){return r.useSearchParams}})}},function(e){e.O(0,[971,23,744],function(){return e(e.s=6981)}),_N_E=e.O()}]);