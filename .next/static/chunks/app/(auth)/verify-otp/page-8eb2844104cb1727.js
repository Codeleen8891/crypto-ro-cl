(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[835],{2645:function(e,t,r){Promise.resolve().then(r.bind(r,1785))},1785:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return u},dynamic:function(){return l},revalidate:function(){return d}});var o=r(7437),s=r(2265),n=r(6463),a=r(6264);/**
 * @license lucide-react v0.438.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let i=(0,r(8030).Z)("ShieldCheck",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]),l="force-dynamic",d=0;function u(){let e=(0,n.useRouter)(),t=(0,n.useSearchParams)().get("email")||"",[r,l]=(0,s.useState)(""),[d,u]=(0,s.useState)(!1),[c,m]=(0,s.useState)(""),[h,f]=(0,s.useState)(60);(0,s.useEffect)(()=>{if(h>0){let e=setTimeout(()=>f(h-1),1e3);return()=>clearTimeout(e)}},[h]);let v=async o=>{o.preventDefault(),u(!0),m("");try{await a.iJ.verifyOtp({email:t,otp:r}),console.log(t,r),alert("âœ… Account verified successfully"),e.push("/login")}catch(e){m((null==e?void 0:e.message)||"OTP verification failed")}finally{u(!1)}},p=async()=>{try{await a.iJ.resendOtp({email:t}),alert("\uD83D\uDCE9 New OTP sent to your email"),f(60)}catch(e){m((null==e?void 0:e.message)||"Failed to resend OTP")}};return(0,o.jsx)("div",{className:"min-h-screen flex items-center justify-center p-6",children:(0,o.jsxs)("div",{className:"card max-w-md w-full p-8",children:[(0,o.jsx)("h1",{className:"h1 mb-6",children:"Verify Your Email"}),(0,o.jsxs)("p",{className:"text-white/70 text-sm mb-4",children:["Enter the 6-digit code we sent to"," ",(0,o.jsx)("span",{className:"font-medium",children:t})]}),c&&(0,o.jsx)("div",{className:"mb-4 text-red-300",children:c}),(0,o.jsxs)("form",{onSubmit:v,className:"space-y-4","data-testid":"register-form",children:[(0,o.jsx)("input",{className:"input tracking-widest text-center",placeholder:"Enter OTP",type:"text",value:r,onChange:e=>l(e.target.value),required:!0}),(0,o.jsxs)("button",{className:"btn btn-primary w-full",disabled:d,children:[(0,o.jsx)(i,{size:18})," ",d?"Verifying...":"Verify"]})]}),(0,o.jsx)("div",{className:"mt-4 text-center text-sm",children:h>0?(0,o.jsxs)("p",{className:"text-white/50",children:["Resend available in"," ",(0,o.jsx)("span",{className:"font-semibold",children:h}),"s"]}):(0,o.jsx)("button",{onClick:p,className:"text-brand-300 underline hover:text-brand-200",children:"Resend OTP"})})]})})}},6264:function(e,t,r){"use strict";r.d(t,{BG:function(){return i},Nq:function(){return u},iJ:function(){return d},xU:function(){return l}});let o="http://localhost:8000/api";function s(){return{adminId:localStorage.getItem("adminId")||"",userId:localStorage.getItem("userId")||""}}async function n(e){if(204===e.status)return null;let t=await e.text();if(!t)return null;try{return JSON.parse(t)}catch(e){return t}}async function a(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!o)throw Error("Missing NEXT_PUBLIC_API_URL");let r=t.body instanceof FormData,s=r?{}:{"Content-Type":"application/json"},a=t.token||localStorage.getItem("token")||"";a&&(s.Authorization="Bearer ".concat(a));let i=await fetch("".concat(o).concat(e),{method:t.method||"GET",headers:s,body:t.body?r?t.body:JSON.stringify(t.body):void 0});if(!i.ok){let e="Request failed: ".concat(i.status);try{let t=await i.json();(null==t?void 0:t.message)?e=t.message:"string"==typeof t&&(e=t)}catch(t){try{let t=await i.text();t&&(e=t)}catch(e){}}throw Error(e)}return await n(i)}let i={me:e=>a("/users/profile",{method:"GET",token:e}),getById:(e,t)=>a("/users/".concat(e),{method:"GET",token:t}),search:(e,t)=>a("/users/search?q=".concat(encodeURIComponent(e)),{method:"GET",token:t}),changePassword:e=>a("/users/password/change",{method:"POST",body:e}),requestPasswordOtp:()=>a("/users/password/request-otp",{method:"POST"}),resetPasswordWithOtp:e=>a("/users/password/reset-otp",{method:"POST",body:e}),updateProfile:(e,t)=>a("/users/profile",{method:"PUT",body:e,token:t}),stats:e=>a("/users/me/stats",{method:"GET",token:e}),unread:e=>a("/users/messages/unread",{method:"GET",token:e})},l={getConversation:(e,t)=>a("/chat/".concat(e),{method:"GET",token:t}),sendMessage:(e,t)=>{let{adminId:r,userId:o}=s(),n=(null==t?void 0:t.senderId)||r||o||"";if(console.log("\uD83D\uDCE4 Sending message:",{sender:n,receiver:e.to,message:e.message,fileUrl:e.fileUrl,type:e.type}),!e.to)throw Error("Receiver ID (data.to) is missing!");return a("/chat/send",{method:"POST",body:{sender:n,receiver:e.to,message:e.message||"",fileUrl:e.fileUrl||"",type:e.type||"text"},token:null==t?void 0:t.token})},upload:async(e,t)=>{let r=await a("/chat/upload",{method:"POST",body:e,token:t}),o=(null==r?void 0:r.fileUrl)||(null==r?void 0:r.url)||"";if(!o)throw Error("Upload failed: missing fileUrl");return{fileUrl:o}},removeUser:(e,t)=>a("/chat/remove/".concat(e),{method:"DELETE",token:t}),getConversations:async e=>{let{userId:t}=s();if(!t)return[];let r=await a("/chat/".concat(t),{method:"GET",token:e});if(!Array.isArray(r)||0===r.length)return[];let o=r[r.length-1],n=(null==o?void 0:o.message)||((null==o?void 0:o.type)==="image"?"[Image]":(null==o?void 0:o.type)==="audio"?"[Audio]":(null==o?void 0:o.type)==="emoji"?"[Emoji]":"");return[{_id:(null==o?void 0:o._id)||"conv-".concat(t),userId:t,lastMessage:n||"",updatedAt:(null==o?void 0:o.createdAt)||new Date().toISOString()}]}},d={register:e=>a("/auth/register",{method:"POST",body:e}),verifyOtp:e=>a("/auth/verify-otp",{method:"POST",body:e}),login:async e=>{var t,r,o,s,n,i;let l=await a("/auth/login",{method:"POST",body:e}),d=(null==l?void 0:l.token)||(null==l?void 0:l.accessToken)||"",u={_id:(null==l?void 0:l._id)||(null==l?void 0:null===(t=l.user)||void 0===t?void 0:t._id)||"",name:(null==l?void 0:l.name)||(null==l?void 0:null===(r=l.user)||void 0===r?void 0:r.name)||"",email:(null==l?void 0:l.email)||(null==l?void 0:null===(o=l.user)||void 0===o?void 0:o.email)||"",photo:(null==l?void 0:l.photo)||(null==l?void 0:null===(s=l.user)||void 0===s?void 0:s.photo)||void 0,role:(null==l?void 0:l.role)||(null==l?void 0:null===(n=l.user)||void 0===n?void 0:n.role)||void 0,createdAt:(null==l?void 0:l.createdAt)||(null==l?void 0:null===(i=l.user)||void 0===i?void 0:i.createdAt)||void 0};if(!d||!u._id)throw Error("Invalid login response from server");return{token:d,user:u}},forgotPassword:e=>a("/auth/forgot-password",{method:"POST",body:e}),resetPassword:(e,t)=>a("/auth/reset-password",{method:"POST",body:e,token:t}),resendOtp:e=>a("/auth/resend-otp",{method:"POST",body:e})},u={stats:e=>a("/admin/stats",{method:"GET",token:e}),usersList:e=>a("/admin/users/list",{method:"GET",token:e}),usersAll:e=>a("/admin/users/all",{method:"GET",token:e})}},8030:function(e,t,r){"use strict";r.d(t,{Z:function(){return l}});var o=r(2265);/**
 * @license lucide-react v0.438.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let s=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),n=function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return t.filter((e,t,r)=>!!e&&r.indexOf(e)===t).join(" ")};/**
 * @license lucide-react v0.438.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var a={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.438.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let i=(0,o.forwardRef)((e,t)=>{let{color:r="currentColor",size:s=24,strokeWidth:i=2,absoluteStrokeWidth:l,className:d="",children:u,iconNode:c,...m}=e;return(0,o.createElement)("svg",{ref:t,...a,width:s,height:s,stroke:r,strokeWidth:l?24*Number(i)/Number(s):i,className:n("lucide",d),...m},[...c.map(e=>{let[t,r]=e;return(0,o.createElement)(t,r)}),...Array.isArray(u)?u:[u]])}),l=(e,t)=>{let r=(0,o.forwardRef)((r,a)=>{let{className:l,...d}=r;return(0,o.createElement)(i,{ref:a,iconNode:t,className:n("lucide-".concat(s(e)),l),...d})});return r.displayName="".concat(e),r}},6463:function(e,t,r){"use strict";var o=r(1169);r.o(o,"useParams")&&r.d(t,{useParams:function(){return o.useParams}}),r.o(o,"usePathname")&&r.d(t,{usePathname:function(){return o.usePathname}}),r.o(o,"useRouter")&&r.d(t,{useRouter:function(){return o.useRouter}}),r.o(o,"useSearchParams")&&r.d(t,{useSearchParams:function(){return o.useSearchParams}})}},function(e){e.O(0,[971,23,744],function(){return e(e.s=2645)}),_N_E=e.O()}]);