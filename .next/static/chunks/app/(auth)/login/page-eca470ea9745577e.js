(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[665],{2737:function(e,t,a){Promise.resolve().then(a.bind(a,5777))},5777:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return u},dynamic:function(){return i},revalidate:function(){return d}});var r=a(7437),s=a(2265),l=a(6264),o=a(6463);/**
 * @license lucide-react v0.438.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let n=(0,a(8030).Z)("LogIn",[["path",{d:"M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4",key:"u53s6r"}],["polyline",{points:"10 17 15 12 10 7",key:"1ail0h"}],["line",{x1:"15",x2:"3",y1:"12",y2:"12",key:"v6grx8"}]]),i="force-dynamic",d=0;function u(){let e=(0,o.useRouter)(),[t,a]=(0,s.useState)(""),[i,d]=(0,s.useState)(""),[u,c]=(0,s.useState)(!1),[m,h]=(0,s.useState)(""),[v,g]=(0,s.useState)(!1),[p,f]=(0,s.useState)("email"),[y,b]=(0,s.useState)(""),[w,x]=(0,s.useState)(""),[P,S]=(0,s.useState)(""),[N,k]=(0,s.useState)(""),[j,T]=(0,s.useState)(!1),E=async a=>{var r,s,o;a.preventDefault(),c(!0),h("");try{let a=await l.iJ.login({email:t,password:i});localStorage.setItem("token",a.token),localStorage.setItem("role",null!==(r=a.user.role)&&void 0!==r?r:"user"),"admin"===a.user.role?(localStorage.setItem("adminId",a.user._id),e.push("/admin")):(localStorage.setItem("userId",a.user._id),e.push("/dashboard"))}catch(e){h((null==e?void 0:null===(o=e.response)||void 0===o?void 0:null===(s=o.data)||void 0===s?void 0:s.message)||(null==e?void 0:e.message)||"Login failed")}finally{c(!1)}},O=async()=>{try{if(T(!0),k(""),"email"===p){let e=await l.iJ.forgotPassword({email:y});k(e.message||"OTP has been sent to your email."),f("otp")}else{let e=await l.iJ.resetPassword({newPassword:P},w);k(e.message||"Password reset successfully."),setTimeout(()=>{g(!1),f("email"),b(""),x(""),S(""),k("")},2e3)}}catch(a){var e,t;k((null==a?void 0:null===(t=a.response)||void 0===t?void 0:null===(e=t.data)||void 0===e?void 0:e.message)||(null==a?void 0:a.message)||"Request failed")}finally{T(!1)}},C=async()=>{try{T(!0),k("");let e=await l.iJ.resendOtp({email:y});k(e.message||"A new OTP has been sent to your email.")}catch(a){var e,t;k((null==a?void 0:null===(t=a.response)||void 0===t?void 0:null===(e=t.data)||void 0===e?void 0:e.message)||(null==a?void 0:a.message)||"Failed to resend OTP")}finally{T(!1)}};return(0,r.jsxs)("div",{className:"min-h-screen flex items-center justify-center p-6",children:[(0,r.jsxs)("div",{className:"card max-w-md w-full p-8 bg-white/10 backdrop-blur-lg rounded-2xl",children:[(0,r.jsx)("h1",{className:"h1 mb-6 text-center text-white",children:"Welcome back"}),m&&(0,r.jsx)("div",{className:"mb-4 text-red-300",children:m}),(0,r.jsxs)("form",{onSubmit:E,className:"space-y-4","data-testid":"register-form",children:[(0,r.jsx)("input",{className:"input bg-white text-black placeholder-gray-500 w-full",placeholder:"Email",type:"email",value:t,onChange:e=>a(e.target.value),required:!0}),(0,r.jsx)("input",{className:"input bg-white text-black placeholder-gray-500 w-full",placeholder:"Password",type:"password",value:i,onChange:e=>d(e.target.value),required:!0}),(0,r.jsxs)("button",{className:"btn btn-primary w-full",disabled:u,children:[(0,r.jsx)(n,{size:18}),u?"Signing in...":"Sign in"]})]}),(0,r.jsx)("p",{className:"mt-4 text-sm text-white/70 text-center",children:(0,r.jsx)("button",{className:"text-brand-300 hover:underline",onClick:()=>g(!0),children:"Forgot password?"})}),(0,r.jsxs)("p",{className:"mt-2 text-sm text-white/70 text-center",children:["No account?"," ",(0,r.jsx)("a",{href:"/register",className:"text-brand-300 hover:underline",children:"Create one"})]}),(0,r.jsxs)("p",{className:"mt-2 text-sm text-white/70 text-center",children:["Already registered but not verified?"," ",(0,r.jsx)("button",{className:"text-brand-300 hover:underline",onClick:()=>{if(!t){alert("Please enter your email above first.");return}e.push("/verify-otp?email=".concat(encodeURIComponent(t)))},children:"Activate account"})]})]}),v&&(0,r.jsx)("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center z-50",children:(0,r.jsxs)("div",{className:"bg-white rounded-2xl shadow-xl w-full max-w-md p-6 relative",children:[(0,r.jsx)("h2",{className:"text-xl font-semibold mb-4 text-black",children:"Reset Password"}),N&&(0,r.jsx)("div",{className:"mb-3 text-sm text-blue-600",children:N}),"email"===p&&(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsx)("input",{type:"email",className:"input w-full bg-white text-black placeholder-gray-500",placeholder:"Enter your email",value:y,onChange:e=>b(e.target.value)}),(0,r.jsx)("button",{className:"btn btn-primary w-full",onClick:O,disabled:j,children:j?"Sending OTP...":"Send OTP"})]}),"otp"===p&&(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsx)("input",{type:"text",className:"input w-full bg-white text-black placeholder-gray-500",placeholder:"Enter OTP",value:w,onChange:e=>x(e.target.value)}),(0,r.jsx)("input",{type:"password",className:"input w-full bg-white text-black placeholder-gray-500",placeholder:"Enter new password",value:P,onChange:e=>S(e.target.value)}),(0,r.jsx)("button",{className:"btn btn-primary w-full bg-blue-600 text-white hover:bg-blue-700 rounded-lg py-2 text-center",onClick:O,disabled:j,children:j?"Resetting...":"Reset Password"}),(0,r.jsx)("button",{className:"btn btn-primary w-full bg-blue-600 text-white hover:bg-blue-700 rounded-lg py-2 text-center",onClick:C,disabled:j,children:j?"Resending...":"Resend OTP"})]}),(0,r.jsx)("button",{className:"absolute top-2 right-2 text-gray-500 hover:text-black",onClick:()=>g(!1),children:"âœ•"})]})})]})}},6264:function(e,t,a){"use strict";a.d(t,{BG:function(){return n},Nq:function(){return u},iJ:function(){return d},xU:function(){return i}});let r="http://localhost:8000/api";function s(){return{adminId:localStorage.getItem("adminId")||"",userId:localStorage.getItem("userId")||""}}async function l(e){if(204===e.status)return null;let t=await e.text();if(!t)return null;try{return JSON.parse(t)}catch(e){return t}}async function o(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!r)throw Error("Missing NEXT_PUBLIC_API_URL");let a=t.body instanceof FormData,s=a?{}:{"Content-Type":"application/json"},o=t.token||localStorage.getItem("token")||"";o&&(s.Authorization="Bearer ".concat(o));let n=await fetch("".concat(r).concat(e),{method:t.method||"GET",headers:s,body:t.body?a?t.body:JSON.stringify(t.body):void 0});if(!n.ok){let e="Request failed: ".concat(n.status);try{let t=await n.json();(null==t?void 0:t.message)?e=t.message:"string"==typeof t&&(e=t)}catch(t){try{let t=await n.text();t&&(e=t)}catch(e){}}throw Error(e)}return await l(n)}let n={me:e=>o("/users/profile",{method:"GET",token:e}),getById:(e,t)=>o("/users/".concat(e),{method:"GET",token:t}),search:(e,t)=>o("/users/search?q=".concat(encodeURIComponent(e)),{method:"GET",token:t}),changePassword:e=>o("/users/password/change",{method:"POST",body:e}),requestPasswordOtp:()=>o("/users/password/request-otp",{method:"POST"}),resetPasswordWithOtp:e=>o("/users/password/reset-otp",{method:"POST",body:e}),updateProfile:(e,t)=>o("/users/profile",{method:"PUT",body:e,token:t}),stats:e=>o("/users/me/stats",{method:"GET",token:e}),unread:e=>o("/users/messages/unread",{method:"GET",token:e})},i={getConversation:(e,t)=>o("/chat/".concat(e),{method:"GET",token:t}),sendMessage:(e,t)=>{let{adminId:a,userId:r}=s(),l=(null==t?void 0:t.senderId)||a||r||"";if(console.log("\uD83D\uDCE4 Sending message:",{sender:l,receiver:e.to,message:e.message,fileUrl:e.fileUrl,type:e.type}),!e.to)throw Error("Receiver ID (data.to) is missing!");return o("/chat/send",{method:"POST",body:{sender:l,receiver:e.to,message:e.message||"",fileUrl:e.fileUrl||"",type:e.type||"text"},token:null==t?void 0:t.token})},upload:async(e,t)=>{let a=await o("/chat/upload",{method:"POST",body:e,token:t}),r=(null==a?void 0:a.fileUrl)||(null==a?void 0:a.url)||"";if(!r)throw Error("Upload failed: missing fileUrl");return{fileUrl:r}},removeUser:(e,t)=>o("/chat/remove/".concat(e),{method:"DELETE",token:t}),getConversations:async e=>{let{userId:t}=s();if(!t)return[];let a=await o("/chat/".concat(t),{method:"GET",token:e});if(!Array.isArray(a)||0===a.length)return[];let r=a[a.length-1],l=(null==r?void 0:r.message)||((null==r?void 0:r.type)==="image"?"[Image]":(null==r?void 0:r.type)==="audio"?"[Audio]":(null==r?void 0:r.type)==="emoji"?"[Emoji]":"");return[{_id:(null==r?void 0:r._id)||"conv-".concat(t),userId:t,lastMessage:l||"",updatedAt:(null==r?void 0:r.createdAt)||new Date().toISOString()}]}},d={register:e=>o("/auth/register",{method:"POST",body:e}),verifyOtp:e=>o("/auth/verify-otp",{method:"POST",body:e}),login:async e=>{var t,a,r,s,l,n;let i=await o("/auth/login",{method:"POST",body:e}),d=(null==i?void 0:i.token)||(null==i?void 0:i.accessToken)||"",u={_id:(null==i?void 0:i._id)||(null==i?void 0:null===(t=i.user)||void 0===t?void 0:t._id)||"",name:(null==i?void 0:i.name)||(null==i?void 0:null===(a=i.user)||void 0===a?void 0:a.name)||"",email:(null==i?void 0:i.email)||(null==i?void 0:null===(r=i.user)||void 0===r?void 0:r.email)||"",photo:(null==i?void 0:i.photo)||(null==i?void 0:null===(s=i.user)||void 0===s?void 0:s.photo)||void 0,role:(null==i?void 0:i.role)||(null==i?void 0:null===(l=i.user)||void 0===l?void 0:l.role)||void 0,createdAt:(null==i?void 0:i.createdAt)||(null==i?void 0:null===(n=i.user)||void 0===n?void 0:n.createdAt)||void 0};if(!d||!u._id)throw Error("Invalid login response from server");return{token:d,user:u}},forgotPassword:e=>o("/auth/forgot-password",{method:"POST",body:e}),resetPassword:(e,t)=>o("/auth/reset-password",{method:"POST",body:e,token:t}),resendOtp:e=>o("/auth/resend-otp",{method:"POST",body:e})},u={stats:e=>o("/admin/stats",{method:"GET",token:e}),usersList:e=>o("/admin/users/list",{method:"GET",token:e}),usersAll:e=>o("/admin/users/all",{method:"GET",token:e})}},8030:function(e,t,a){"use strict";a.d(t,{Z:function(){return i}});var r=a(2265);/**
 * @license lucide-react v0.438.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let s=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),l=function(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return t.filter((e,t,a)=>!!e&&a.indexOf(e)===t).join(" ")};/**
 * @license lucide-react v0.438.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var o={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.438.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let n=(0,r.forwardRef)((e,t)=>{let{color:a="currentColor",size:s=24,strokeWidth:n=2,absoluteStrokeWidth:i,className:d="",children:u,iconNode:c,...m}=e;return(0,r.createElement)("svg",{ref:t,...o,width:s,height:s,stroke:a,strokeWidth:i?24*Number(n)/Number(s):n,className:l("lucide",d),...m},[...c.map(e=>{let[t,a]=e;return(0,r.createElement)(t,a)}),...Array.isArray(u)?u:[u]])}),i=(e,t)=>{let a=(0,r.forwardRef)((a,o)=>{let{className:i,...d}=a;return(0,r.createElement)(n,{ref:o,iconNode:t,className:l("lucide-".concat(s(e)),i),...d})});return a.displayName="".concat(e),a}},6463:function(e,t,a){"use strict";var r=a(1169);a.o(r,"useParams")&&a.d(t,{useParams:function(){return r.useParams}}),a.o(r,"usePathname")&&a.d(t,{usePathname:function(){return r.usePathname}}),a.o(r,"useRouter")&&a.d(t,{useRouter:function(){return r.useRouter}}),a.o(r,"useSearchParams")&&a.d(t,{useSearchParams:function(){return r.useSearchParams}})}},function(e){e.O(0,[971,23,744],function(){return e(e.s=2737)}),_N_E=e.O()}]);