(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[566],{3105:function(e,t,r){Promise.resolve().then(r.bind(r,8200))},8200:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return d},dynamic:function(){return l},revalidate:function(){return u}});var a=r(7437),o=r(2265),n=r(6463),s=r(6264);/**
 * @license lucide-react v0.438.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let i=(0,r(8030).Z)("UserPlus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]),l="force-dynamic",u=0;function d(){let e=(0,n.useRouter)(),[t,r]=(0,o.useState)(""),[l,u]=(0,o.useState)(""),[d,c]=(0,o.useState)(""),[m,h]=(0,o.useState)(null),[v,f]=(0,o.useState)(!1),[p,g]=(0,o.useState)(""),y=async r=>{r.preventDefault(),f(!0),g("");try{let r=new FormData;r.append("name",t),r.append("email",l),r.append("password",d),m&&r.append("photo",m),await s.iJ.register(r),alert("âœ… OTP sent to your email"),e.push("/verify-otp?email=".concat(l))}catch(e){var a,o;g((null==e?void 0:e.message)||(null==e?void 0:null===(o=e.response)||void 0===o?void 0:null===(a=o.data)||void 0===a?void 0:a.message)||"Registration failed")}finally{f(!1)}};return(0,a.jsx)("div",{className:"min-h-screen flex items-center justify-center p-6",children:(0,a.jsxs)("div",{className:"card max-w-md w-full p-8",children:[(0,a.jsx)("h1",{className:"h1 mb-6",children:"Create Account"}),p&&(0,a.jsx)("div",{className:"mb-4 text-red-300",children:p}),(0,a.jsxs)("form",{onSubmit:y,className:"space-y-4","data-testid":"register-form",children:[(0,a.jsx)("input",{className:"input",placeholder:"Full Name",type:"text",value:t,onChange:e=>r(e.target.value),required:!0}),(0,a.jsx)("input",{className:"input",placeholder:"Email",type:"email",value:l,onChange:e=>u(e.target.value),required:!0}),(0,a.jsx)("input",{className:"input",placeholder:"Password",type:"password",value:d,onChange:e=>c(e.target.value),required:!0}),(0,a.jsx)("input",{type:"file",accept:"image/*",onChange:e=>{var t;return h((null===(t=e.target.files)||void 0===t?void 0:t[0])||null)},className:"input file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:bg-brand-500 file:text-white hover:file:bg-brand-600"}),(0,a.jsxs)("button",{className:"btn btn-primary w-full",disabled:v,children:[(0,a.jsx)(i,{size:18})," ",v?"Registering...":"Register"]})]}),(0,a.jsxs)("p",{className:"mt-4 text-sm text-white/70",children:["Already have an account?"," ",(0,a.jsx)("a",{href:"/login",className:"text-brand-300 hover:underline",children:"Sign in"})]})]})})}},6264:function(e,t,r){"use strict";r.d(t,{BG:function(){return i},Nq:function(){return d},iJ:function(){return u},xU:function(){return l}});let a="http://localhost:8000/api";function o(){return{adminId:localStorage.getItem("adminId")||"",userId:localStorage.getItem("userId")||""}}async function n(e){if(204===e.status)return null;let t=await e.text();if(!t)return null;try{return JSON.parse(t)}catch(e){return t}}async function s(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!a)throw Error("Missing NEXT_PUBLIC_API_URL");let r=t.body instanceof FormData,o=r?{}:{"Content-Type":"application/json"},s=t.token||localStorage.getItem("token")||"";s&&(o.Authorization="Bearer ".concat(s));let i=await fetch("".concat(a).concat(e),{method:t.method||"GET",headers:o,body:t.body?r?t.body:JSON.stringify(t.body):void 0});if(!i.ok){let e="Request failed: ".concat(i.status);try{let t=await i.json();(null==t?void 0:t.message)?e=t.message:"string"==typeof t&&(e=t)}catch(t){try{let t=await i.text();t&&(e=t)}catch(e){}}throw Error(e)}return await n(i)}let i={me:e=>s("/users/profile",{method:"GET",token:e}),getById:(e,t)=>s("/users/".concat(e),{method:"GET",token:t}),search:(e,t)=>s("/users/search?q=".concat(encodeURIComponent(e)),{method:"GET",token:t}),changePassword:e=>s("/users/password/change",{method:"POST",body:e}),requestPasswordOtp:()=>s("/users/password/request-otp",{method:"POST"}),resetPasswordWithOtp:e=>s("/users/password/reset-otp",{method:"POST",body:e}),updateProfile:(e,t)=>s("/users/profile",{method:"PUT",body:e,token:t}),stats:e=>s("/users/me/stats",{method:"GET",token:e}),unread:e=>s("/users/messages/unread",{method:"GET",token:e})},l={getConversation:(e,t)=>s("/chat/".concat(e),{method:"GET",token:t}),sendMessage:(e,t)=>{let{adminId:r,userId:a}=o(),n=(null==t?void 0:t.senderId)||r||a||"";if(console.log("\uD83D\uDCE4 Sending message:",{sender:n,receiver:e.to,message:e.message,fileUrl:e.fileUrl,type:e.type}),!e.to)throw Error("Receiver ID (data.to) is missing!");return s("/chat/send",{method:"POST",body:{sender:n,receiver:e.to,message:e.message||"",fileUrl:e.fileUrl||"",type:e.type||"text"},token:null==t?void 0:t.token})},upload:async(e,t)=>{let r=await s("/chat/upload",{method:"POST",body:e,token:t}),a=(null==r?void 0:r.fileUrl)||(null==r?void 0:r.url)||"";if(!a)throw Error("Upload failed: missing fileUrl");return{fileUrl:a}},removeUser:(e,t)=>s("/chat/remove/".concat(e),{method:"DELETE",token:t}),getConversations:async e=>{let{userId:t}=o();if(!t)return[];let r=await s("/chat/".concat(t),{method:"GET",token:e});if(!Array.isArray(r)||0===r.length)return[];let a=r[r.length-1],n=(null==a?void 0:a.message)||((null==a?void 0:a.type)==="image"?"[Image]":(null==a?void 0:a.type)==="audio"?"[Audio]":(null==a?void 0:a.type)==="emoji"?"[Emoji]":"");return[{_id:(null==a?void 0:a._id)||"conv-".concat(t),userId:t,lastMessage:n||"",updatedAt:(null==a?void 0:a.createdAt)||new Date().toISOString()}]}},u={register:e=>s("/auth/register",{method:"POST",body:e}),verifyOtp:e=>s("/auth/verify-otp",{method:"POST",body:e}),login:async e=>{var t,r,a,o,n,i;let l=await s("/auth/login",{method:"POST",body:e}),u=(null==l?void 0:l.token)||(null==l?void 0:l.accessToken)||"",d={_id:(null==l?void 0:l._id)||(null==l?void 0:null===(t=l.user)||void 0===t?void 0:t._id)||"",name:(null==l?void 0:l.name)||(null==l?void 0:null===(r=l.user)||void 0===r?void 0:r.name)||"",email:(null==l?void 0:l.email)||(null==l?void 0:null===(a=l.user)||void 0===a?void 0:a.email)||"",photo:(null==l?void 0:l.photo)||(null==l?void 0:null===(o=l.user)||void 0===o?void 0:o.photo)||void 0,role:(null==l?void 0:l.role)||(null==l?void 0:null===(n=l.user)||void 0===n?void 0:n.role)||void 0,createdAt:(null==l?void 0:l.createdAt)||(null==l?void 0:null===(i=l.user)||void 0===i?void 0:i.createdAt)||void 0};if(!u||!d._id)throw Error("Invalid login response from server");return{token:u,user:d}},forgotPassword:e=>s("/auth/forgot-password",{method:"POST",body:e}),resetPassword:(e,t)=>s("/auth/reset-password",{method:"POST",body:e,token:t}),resendOtp:e=>s("/auth/resend-otp",{method:"POST",body:e})},d={stats:e=>s("/admin/stats",{method:"GET",token:e}),usersList:e=>s("/admin/users/list",{method:"GET",token:e}),usersAll:e=>s("/admin/users/all",{method:"GET",token:e})}},8030:function(e,t,r){"use strict";r.d(t,{Z:function(){return l}});var a=r(2265);/**
 * @license lucide-react v0.438.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let o=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),n=function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return t.filter((e,t,r)=>!!e&&r.indexOf(e)===t).join(" ")};/**
 * @license lucide-react v0.438.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var s={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.438.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let i=(0,a.forwardRef)((e,t)=>{let{color:r="currentColor",size:o=24,strokeWidth:i=2,absoluteStrokeWidth:l,className:u="",children:d,iconNode:c,...m}=e;return(0,a.createElement)("svg",{ref:t,...s,width:o,height:o,stroke:r,strokeWidth:l?24*Number(i)/Number(o):i,className:n("lucide",u),...m},[...c.map(e=>{let[t,r]=e;return(0,a.createElement)(t,r)}),...Array.isArray(d)?d:[d]])}),l=(e,t)=>{let r=(0,a.forwardRef)((r,s)=>{let{className:l,...u}=r;return(0,a.createElement)(i,{ref:s,iconNode:t,className:n("lucide-".concat(o(e)),l),...u})});return r.displayName="".concat(e),r}},6463:function(e,t,r){"use strict";var a=r(1169);r.o(a,"useParams")&&r.d(t,{useParams:function(){return a.useParams}}),r.o(a,"usePathname")&&r.d(t,{usePathname:function(){return a.usePathname}}),r.o(a,"useRouter")&&r.d(t,{useRouter:function(){return a.useRouter}}),r.o(a,"useSearchParams")&&r.d(t,{useSearchParams:function(){return a.useSearchParams}})}},function(e){e.O(0,[971,23,744],function(){return e(e.s=3105)}),_N_E=e.O()}]);