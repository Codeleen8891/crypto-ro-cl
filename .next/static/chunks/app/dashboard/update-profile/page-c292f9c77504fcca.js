(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[132],{8218:function(e,t,a){Promise.resolve().then(a.bind(a,4658))},4658:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return l}});var s=a(7437),o=a(6463),n=a(2265),r=a(6264);function l(){var e,t;let[a,l]=(0,n.useState)(null),[i,d]=(0,n.useState)(null),[u,c]=(0,n.useState)(""),[h,m]=(0,n.useState)(""),[p,v]=(0,n.useState)(!1),[f,g]=(0,n.useState)(""),[y,w]=(0,n.useState)(""),[b,P]=(0,n.useState)(""),[x,S]=(0,n.useState)(!1),j=(0,o.useRouter)();(0,n.useEffect)(()=>{(async()=>{try{let e=await r.BG.me();l(e),c(e.name||"")}catch(e){console.error("Failed to fetch user profile",e),j.push("/login")}})()},[]),console.log("".concat("http://localhost:8000","/").concat(null==a?void 0:a.photo));let N=async e=>{if(e.preventDefault(),!a)return;let t=new FormData;t.append("name",u),i&&t.append("photo",i);try{await r.BG.updateProfile(t);let e=await r.BG.me();console.log(e),l(e),m("Profile updated successfully."),localStorage.setItem("user",JSON.stringify(e)),window.dispatchEvent(new Event("user-updated")),e._id&&("admin"===e.role?localStorage.setItem("adminId",e._id):localStorage.setItem("userId",e._id))}catch(e){m((null==e?void 0:e.message)||"Failed to update profile.")}},E=async()=>{try{if(x)await r.BG.resetPasswordWithOtp({otp:b,newPassword:y}),m("Password reset successfully.");else if(f)await r.BG.changePassword({oldPassword:f,newPassword:y}),m("Password changed successfully.");else{await r.BG.requestPasswordOtp(),S(!0),m("OTP sent to your email.");return}v(!1),g(""),w(""),P(""),S(!1)}catch(e){m((null==e?void 0:e.message)||"Password change failed.")}};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("h1",{className:"h1",children:"Update your Profile"}),(0,s.jsxs)("div",{className:"card p-6 max-w-xl",children:[h&&(0,s.jsx)("div",{className:"mb-4 text-brand-200",children:h}),(0,s.jsxs)("form",{onSubmit:N,className:"space-y-4",children:[(0,s.jsxs)("div",{className:"flex items-center gap-4",children:[(null==a?void 0:a.photo)?(0,s.jsx)("img",{src:a.photo.startsWith("http")?a.photo:"".concat("http://localhost:8000","/").concat(a.photo),alt:"photo",className:"w-16 h-16 rounded-full border border-white/20 object-cover"}):(0,s.jsx)("span",{className:"w-16 h-16 rounded-full border border-white/20 bg-brand-700 flex items-center justify-center text-xl font-semibold text-white",children:(null==a?void 0:null===(t=a.name)||void 0===t?void 0:null===(e=t[0])||void 0===e?void 0:e.toUpperCase())||"U"}),(0,s.jsx)("input",{className:"input",type:"file",accept:"image/*",onChange:e=>{var t,a;return d(null!==(a=null===(t=e.target.files)||void 0===t?void 0:t[0])&&void 0!==a?a:null)}})]}),(0,s.jsx)("input",{className:"input",value:u,onChange:e=>c(e.target.value),placeholder:"Full Name"}),(0,s.jsx)("button",{type:"button",className:"btn btn-secondary",onClick:()=>v(!0),children:"Change Password"}),(0,s.jsx)("button",{className:"btn btn-primary",children:"Save"})]})]}),p&&(0,s.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center",children:(0,s.jsxs)("div",{className:"bg-white text-black rounded-lg p-6 w-96 space-y-4",children:[(0,s.jsx)("h2",{className:"font-bold text-lg",children:"Change Password"}),x?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("input",{className:"input",value:b,onChange:e=>P(e.target.value),placeholder:"Enter OTP"}),(0,s.jsx)("input",{className:"input",type:"password",value:y,onChange:e=>w(e.target.value),placeholder:"New Password"})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("input",{className:"input",type:"password",value:f,onChange:e=>g(e.target.value),placeholder:"Old Password (leave blank if forgotten)"}),(0,s.jsx)("input",{className:"input",type:"password",value:y,onChange:e=>w(e.target.value),placeholder:"New Password"})]}),(0,s.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,s.jsx)("button",{type:"button",className:"btn",onClick:()=>v(!1),children:"Cancel"}),(0,s.jsx)("button",{type:"button",className:"btn btn-primary",onClick:E,children:"Submit"})]})]})})]})}},6264:function(e,t,a){"use strict";a.d(t,{BG:function(){return l},Nq:function(){return u},iJ:function(){return d},xU:function(){return i}});let s="http://localhost:8000/api";function o(){return{adminId:localStorage.getItem("adminId")||"",userId:localStorage.getItem("userId")||""}}async function n(e){if(204===e.status)return null;let t=await e.text();if(!t)return null;try{return JSON.parse(t)}catch(e){return t}}async function r(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!s)throw Error("Missing NEXT_PUBLIC_API_URL");let a=t.body instanceof FormData,o=a?{}:{"Content-Type":"application/json"},r=t.token||localStorage.getItem("token")||"";r&&(o.Authorization="Bearer ".concat(r));let l=await fetch("".concat(s).concat(e),{method:t.method||"GET",headers:o,body:t.body?a?t.body:JSON.stringify(t.body):void 0});if(!l.ok){let e="Request failed: ".concat(l.status);try{let t=await l.json();(null==t?void 0:t.message)?e=t.message:"string"==typeof t&&(e=t)}catch(t){try{let t=await l.text();t&&(e=t)}catch(e){}}throw Error(e)}return await n(l)}let l={me:e=>r("/users/profile",{method:"GET",token:e}),getById:(e,t)=>r("/users/".concat(e),{method:"GET",token:t}),search:(e,t)=>r("/users/search?q=".concat(encodeURIComponent(e)),{method:"GET",token:t}),changePassword:e=>r("/users/password/change",{method:"POST",body:e}),requestPasswordOtp:()=>r("/users/password/request-otp",{method:"POST"}),resetPasswordWithOtp:e=>r("/users/password/reset-otp",{method:"POST",body:e}),updateProfile:(e,t)=>r("/users/profile",{method:"PUT",body:e,token:t}),stats:e=>r("/users/me/stats",{method:"GET",token:e}),unread:e=>r("/users/messages/unread",{method:"GET",token:e})},i={getConversation:(e,t)=>r("/chat/".concat(e),{method:"GET",token:t}),sendMessage:(e,t)=>{let{adminId:a,userId:s}=o(),n=(null==t?void 0:t.senderId)||a||s||"";if(console.log("\uD83D\uDCE4 Sending message:",{sender:n,receiver:e.to,message:e.message,fileUrl:e.fileUrl,type:e.type}),!e.to)throw Error("Receiver ID (data.to) is missing!");return r("/chat/send",{method:"POST",body:{sender:n,receiver:e.to,message:e.message||"",fileUrl:e.fileUrl||"",type:e.type||"text"},token:null==t?void 0:t.token})},upload:async(e,t)=>{let a=await r("/chat/upload",{method:"POST",body:e,token:t}),s=(null==a?void 0:a.fileUrl)||(null==a?void 0:a.url)||"";if(!s)throw Error("Upload failed: missing fileUrl");return{fileUrl:s}},removeUser:(e,t)=>r("/chat/remove/".concat(e),{method:"DELETE",token:t}),getConversations:async e=>{let{userId:t}=o();if(!t)return[];let a=await r("/chat/".concat(t),{method:"GET",token:e});if(!Array.isArray(a)||0===a.length)return[];let s=a[a.length-1],n=(null==s?void 0:s.message)||((null==s?void 0:s.type)==="image"?"[Image]":(null==s?void 0:s.type)==="audio"?"[Audio]":(null==s?void 0:s.type)==="emoji"?"[Emoji]":"");return[{_id:(null==s?void 0:s._id)||"conv-".concat(t),userId:t,lastMessage:n||"",updatedAt:(null==s?void 0:s.createdAt)||new Date().toISOString()}]}},d={register:e=>r("/auth/register",{method:"POST",body:e}),verifyOtp:e=>r("/auth/verify-otp",{method:"POST",body:e}),login:async e=>{var t,a,s,o,n,l;let i=await r("/auth/login",{method:"POST",body:e}),d=(null==i?void 0:i.token)||(null==i?void 0:i.accessToken)||"",u={_id:(null==i?void 0:i._id)||(null==i?void 0:null===(t=i.user)||void 0===t?void 0:t._id)||"",name:(null==i?void 0:i.name)||(null==i?void 0:null===(a=i.user)||void 0===a?void 0:a.name)||"",email:(null==i?void 0:i.email)||(null==i?void 0:null===(s=i.user)||void 0===s?void 0:s.email)||"",photo:(null==i?void 0:i.photo)||(null==i?void 0:null===(o=i.user)||void 0===o?void 0:o.photo)||void 0,role:(null==i?void 0:i.role)||(null==i?void 0:null===(n=i.user)||void 0===n?void 0:n.role)||void 0,createdAt:(null==i?void 0:i.createdAt)||(null==i?void 0:null===(l=i.user)||void 0===l?void 0:l.createdAt)||void 0};if(!d||!u._id)throw Error("Invalid login response from server");return{token:d,user:u}},forgotPassword:e=>r("/auth/forgot-password",{method:"POST",body:e}),resetPassword:(e,t)=>r("/auth/reset-password",{method:"POST",body:e,token:t}),resendOtp:e=>r("/auth/resend-otp",{method:"POST",body:e})},u={stats:e=>r("/admin/stats",{method:"GET",token:e}),usersList:e=>r("/admin/users/list",{method:"GET",token:e}),usersAll:e=>r("/admin/users/all",{method:"GET",token:e})}},6463:function(e,t,a){"use strict";var s=a(1169);a.o(s,"useParams")&&a.d(t,{useParams:function(){return s.useParams}}),a.o(s,"usePathname")&&a.d(t,{usePathname:function(){return s.usePathname}}),a.o(s,"useRouter")&&a.d(t,{useRouter:function(){return s.useRouter}}),a.o(s,"useSearchParams")&&a.d(t,{useSearchParams:function(){return s.useSearchParams}})}},function(e){e.O(0,[971,23,744],function(){return e(e.s=8218)}),_N_E=e.O()}]);