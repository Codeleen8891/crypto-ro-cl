(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[580],{1672:function(e,t,r){Promise.resolve().then(r.bind(r,4415))},4415:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return l}});var o=r(7437),s=r(6463),n=r(2265),a=r(6264);function l(){let[e,t]=(0,n.useState)(null),[r,l]=(0,n.useState)({field:null}),i=(0,s.useRouter)();if((0,n.useEffect)(()=>{(async()=>{try{let e=await a.BG.me();console.log(e),t(e)}catch(e){console.error("Failed to fetch user:",e),i.push("/login")}})()},[]),!e)return(0,o.jsx)("p",{children:"Loading..."});let d="".concat(window.location.origin,"/register?ref=").concat(e.referralCode),u=async(e,t)=>{try{await navigator.clipboard.writeText(e),l({field:t}),setTimeout(()=>l({field:null}),2e3)}catch(e){console.error("Failed to copy:",e)}};return(0,o.jsxs)("div",{className:"p-6 bg-brand-900/40 rounded-2xl text-white",children:[(0,o.jsx)("h2",{className:"text-2xl font-bold mb-4",children:"Referral Program"}),(0,o.jsx)("p",{className:"mb-2",children:"Invite friends and earn rewards!"}),(0,o.jsxs)("div",{className:"bg-brand-800 p-4 rounded-xl mb-4 space-y-4",children:[(0,o.jsxs)("div",{children:[(0,o.jsx)("p",{className:"font-semibold",children:"Your Referral Code:"}),(0,o.jsxs)("div",{className:"flex gap-2 items-center mt-1",children:[(0,o.jsx)("input",{type:"text",readOnly:!0,className:"flex-1 bg-brand-700 p-2 rounded text-sm",value:e.referralCode}),(0,o.jsx)("button",{onClick:()=>u(e.referralCode,"code"),className:"bg-accent text-black px-3 py-2 rounded font-semibold hover:bg-accent/80 transition",children:"Copy"})]}),"code"===r.field&&(0,o.jsx)("p",{className:"text-green-400 text-sm mt-2",children:"✅ Referral code copied!"})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("p",{className:"font-semibold",children:"Your Referral Link:"}),(0,o.jsxs)("div",{className:"flex gap-2 items-center mt-1",children:[(0,o.jsx)("input",{type:"text",readOnly:!0,className:"flex-1 bg-brand-700 p-2 rounded text-sm",value:d}),(0,o.jsx)("button",{onClick:()=>u(d,"link"),className:"bg-accent text-black px-3 py-2 rounded font-semibold hover:bg-accent/80 transition",children:"Copy"})]}),"link"===r.field&&(0,o.jsx)("p",{className:"text-green-400 text-sm mt-2",children:"✅ Referral link copied!"})]})]}),(0,o.jsx)("h3",{className:"text-lg font-semibold mb-2",children:"Your Referrals:"}),(0,o.jsxs)("ul",{className:"space-y-2",children:[0===e.referrals.length&&(0,o.jsx)("li",{children:"No referrals yet."}),e.referrals.map(e=>(0,o.jsxs)("li",{className:"p-3 bg-brand-800 rounded-xl flex justify-between",children:[(0,o.jsx)("span",{children:e.name}),(0,o.jsx)("span",{className:"text-xs text-gray-400",children:e.email})]},e._id))]})]})}},6264:function(e,t,r){"use strict";r.d(t,{BG:function(){return l},Nq:function(){return u},iJ:function(){return d},xU:function(){return i}});let o="http://localhost:8000/api";function s(){return{adminId:localStorage.getItem("adminId")||"",userId:localStorage.getItem("userId")||""}}async function n(e){if(204===e.status)return null;let t=await e.text();if(!t)return null;try{return JSON.parse(t)}catch(e){return t}}async function a(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!o)throw Error("Missing NEXT_PUBLIC_API_URL");let r=t.body instanceof FormData,s=r?{}:{"Content-Type":"application/json"},a=t.token||localStorage.getItem("token")||"";a&&(s.Authorization="Bearer ".concat(a));let l=await fetch("".concat(o).concat(e),{method:t.method||"GET",headers:s,body:t.body?r?t.body:JSON.stringify(t.body):void 0});if(!l.ok){let e="Request failed: ".concat(l.status);try{let t=await l.json();(null==t?void 0:t.message)?e=t.message:"string"==typeof t&&(e=t)}catch(t){try{let t=await l.text();t&&(e=t)}catch(e){}}throw Error(e)}return await n(l)}let l={me:e=>a("/users/profile",{method:"GET",token:e}),getById:(e,t)=>a("/users/".concat(e),{method:"GET",token:t}),search:(e,t)=>a("/users/search?q=".concat(encodeURIComponent(e)),{method:"GET",token:t}),changePassword:e=>a("/users/password/change",{method:"POST",body:e}),requestPasswordOtp:()=>a("/users/password/request-otp",{method:"POST"}),resetPasswordWithOtp:e=>a("/users/password/reset-otp",{method:"POST",body:e}),updateProfile:(e,t)=>a("/users/profile",{method:"PUT",body:e,token:t}),stats:e=>a("/users/me/stats",{method:"GET",token:e}),unread:e=>a("/users/messages/unread",{method:"GET",token:e})},i={getConversation:(e,t)=>a("/chat/".concat(e),{method:"GET",token:t}),sendMessage:(e,t)=>{let{adminId:r,userId:o}=s(),n=(null==t?void 0:t.senderId)||r||o||"";if(console.log("\uD83D\uDCE4 Sending message:",{sender:n,receiver:e.to,message:e.message,fileUrl:e.fileUrl,type:e.type}),!e.to)throw Error("Receiver ID (data.to) is missing!");return a("/chat/send",{method:"POST",body:{sender:n,receiver:e.to,message:e.message||"",fileUrl:e.fileUrl||"",type:e.type||"text"},token:null==t?void 0:t.token})},upload:async(e,t)=>{let r=await a("/chat/upload",{method:"POST",body:e,token:t}),o=(null==r?void 0:r.fileUrl)||(null==r?void 0:r.url)||"";if(!o)throw Error("Upload failed: missing fileUrl");return{fileUrl:o}},removeUser:(e,t)=>a("/chat/remove/".concat(e),{method:"DELETE",token:t}),getConversations:async e=>{let{userId:t}=s();if(!t)return[];let r=await a("/chat/".concat(t),{method:"GET",token:e});if(!Array.isArray(r)||0===r.length)return[];let o=r[r.length-1],n=(null==o?void 0:o.message)||((null==o?void 0:o.type)==="image"?"[Image]":(null==o?void 0:o.type)==="audio"?"[Audio]":(null==o?void 0:o.type)==="emoji"?"[Emoji]":"");return[{_id:(null==o?void 0:o._id)||"conv-".concat(t),userId:t,lastMessage:n||"",updatedAt:(null==o?void 0:o.createdAt)||new Date().toISOString()}]}},d={register:e=>a("/auth/register",{method:"POST",body:e}),verifyOtp:e=>a("/auth/verify-otp",{method:"POST",body:e}),login:async e=>{var t,r,o,s,n,l;let i=await a("/auth/login",{method:"POST",body:e}),d=(null==i?void 0:i.token)||(null==i?void 0:i.accessToken)||"",u={_id:(null==i?void 0:i._id)||(null==i?void 0:null===(t=i.user)||void 0===t?void 0:t._id)||"",name:(null==i?void 0:i.name)||(null==i?void 0:null===(r=i.user)||void 0===r?void 0:r.name)||"",email:(null==i?void 0:i.email)||(null==i?void 0:null===(o=i.user)||void 0===o?void 0:o.email)||"",photo:(null==i?void 0:i.photo)||(null==i?void 0:null===(s=i.user)||void 0===s?void 0:s.photo)||void 0,role:(null==i?void 0:i.role)||(null==i?void 0:null===(n=i.user)||void 0===n?void 0:n.role)||void 0,createdAt:(null==i?void 0:i.createdAt)||(null==i?void 0:null===(l=i.user)||void 0===l?void 0:l.createdAt)||void 0};if(!d||!u._id)throw Error("Invalid login response from server");return{token:d,user:u}},forgotPassword:e=>a("/auth/forgot-password",{method:"POST",body:e}),resetPassword:(e,t)=>a("/auth/reset-password",{method:"POST",body:e,token:t}),resendOtp:e=>a("/auth/resend-otp",{method:"POST",body:e})},u={stats:e=>a("/admin/stats",{method:"GET",token:e}),usersList:e=>a("/admin/users/list",{method:"GET",token:e}),usersAll:e=>a("/admin/users/all",{method:"GET",token:e})}},6463:function(e,t,r){"use strict";var o=r(1169);r.o(o,"useParams")&&r.d(t,{useParams:function(){return o.useParams}}),r.o(o,"usePathname")&&r.d(t,{usePathname:function(){return o.usePathname}}),r.o(o,"useRouter")&&r.d(t,{useRouter:function(){return o.useRouter}}),r.o(o,"useSearchParams")&&r.d(t,{useSearchParams:function(){return o.useSearchParams}})}},function(e){e.O(0,[971,23,744],function(){return e(e.s=1672)}),_N_E=e.O()}]);